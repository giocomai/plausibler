# plausibler

`plausibler` is a wrapper for the R programming language to the
[Plausible Analytics](https://plausible.io/) API. It facilitates making
queries, and getting tidy data frames in return.

See the [Plausible Analytics API
documentation](https://plausible.io/docs/stats-api) for more details on
the API, the endpoints, etc.

## Preliminary notice on API versions

This package has originally been built targeting the Plausible API
version 1. Most documentation on [Plausible’s
website](https://plausible.io/docs/stats-api) refers to API version 2. A
set of new functions are being introduced to facilitate interactions
with API v2, in particular
[`pa2_get()`](https://giocomai.github.io/plausibler/reference/pa2_get.md)
and
[`pa2_df()`](https://giocomai.github.io/plausibler/reference/pa2_df.md).
See relevant examples and documentations for each of these functions.
More structured documentation and examples workflows will be added in
due time.

## Installation

You can install `plausibler` from
[r-universe](https://giocomai.r-universe.dev/plausibler) with:

``` r
install.packages('plausibler', repos = c('https://giocomai.r-universe.dev', 'https://cloud.r-project.org'))
```

Or from GitHub with:

``` r
remotes::install_github("giocomai/plausibler")
```

To facilitate interactive use and auto-complete, each function starts
with “pa\_” (for “Plausible Analytics”) followed by a verb describing
what the function does.

## Example

At the beginning of each session, you will need to set the base url of
your Plausible Analytics instance (if not self-hosted,
<https://plausible.io/>), your `site_id` (the domain of your website),
and your API key.

``` r
pa_set(
  base_url = "https://plausible.io/",
  site_id = "example.com",
  key = "actual_key_here"
)
```

You have then three main options to get data from the API.

If you know exactly your query, you can just go with it. You can
e.g. see your monthly stats for the last six months with:

``` r
pa_get(full_url = "https://plausible.io/api/v1/stats/timeseries?site_id=$SITE_ID&period=6mo")
```

Keep in mind that you will still need to set the key with
[`pa_set()`](https://giocomai.github.io/plausibler/reference/pa_set.md).
Replace \$SITE_ID with your domain in this example, or check out the
[official API documentation](https://plausible.io/docs/stats-api) for
many more examples.

If you prefer to stick to a syntax closer to what you would typically
use in R, you can achieve the same as above with the following:

``` r
pa_get(
  endpoint = "/api/v1/stats/timeseries",
  parameters = list(period = "6mo")
)
```

Finally, you can use wrapper functions, so you don’t need to remember
the endpoint. Here are some example for time series data:

``` r
pa_get_timeseries(period = "6mo")
pa_get_timeseries(period = "30d")
pa_get_timeseries(period = "custom&date=2021-06-01,2021-06-07")
```

Here are some example for breakdown of stats:

``` r
pa_get_breakdown(period = "30d", property = "event:page")

# which is exactly the same as:
pa_get_top_pages()
```

If you are interested in more metrics, see:

``` r
pa_get_breakdown(
  period = "30d",
  property = "event:page",
  metrics = c(
    "visitors",
    "pageviews",
    "bounce_rate",
    "visit_duration"
  ),
  limit = 1000
)
```

Or, say, combining properties, metrics, and filters, to see the
referrers for visits to a given page:

``` r
pa_get_breakdown(
  period = "6mo",
  property = "visit:referrer",
  metrics = c(
    "visitors",
    "pageviews",
    "bounce_rate",
    "visit_duration"
  ),
  limit = 1000,
  filters = list(`event:page` = "/example/")
)
```

It is possible to query for custom periods:

``` r
pa_get_breakdown(
  period = "custom&date=2023-04-01,2023-06-30",
  property = "event:page"
)
```

It is also possible to get aggregate stats:

``` r
pa_get_aggregate()
```

## Breakdown by multiple properties

As breakdown by multiple properties has not been natively implemented in
the API, `plausibler` offers a convenience function that tries to
achieve the same result by repeated queries, iterating through each
occurrence of a property on a given date.

The following should get the number of visitors from each source to each
page on each date of the last week.

``` r
pa_get_properties_by_date(
  property1 = "visit:source",
  property2 = "event:page"
)
```

Depending on the number of “sources” recorded, this is likely to be
slow. In order to speed up the process and reduce load on the API, by
default this function caches data in a SQLite database created within
the current working directory. Only data for full days should be cached
(i.e. it’s safer not to include the current date, even if this is not
enforced).

## Future development

- more wrapper functions
- maybe, more extensive local caching with sqlite
- suggestions? Open an issue

# Package index

## All functions

- [`pa2_df()`](https://giocomai.github.io/plausibler/reference/pa2_df.md)
  : Transform API response from list to data frame
- [`pa2_get()`](https://giocomai.github.io/plausibler/reference/pa2_get.md)
  : Gets data from Plausible Analytics API (v2)
- [`pa_create_handler()`](https://giocomai.github.io/plausibler/reference/pa_create_handler.md)
  : Creates a curl handler object with API keys (used internally)
- [`pa_get()`](https://giocomai.github.io/plausibler/reference/pa_get.md)
  : Gets data from Plausible Analytics API
- [`pa_get_aggregate()`](https://giocomai.github.io/plausibler/reference/pa_get_aggregate.md)
  : Get aggregated stats for a given website
- [`pa_get_breakdown()`](https://giocomai.github.io/plausibler/reference/pa_get_breakdown.md)
  : Get a breakdown of stats by a given property
- [`pa_get_breakdown_by_date()`](https://giocomai.github.io/plausibler/reference/pa_get_breakdown_by_date.md)
  : Get breakdown by date and a single property
- [`pa_get_page_aggregate()`](https://giocomai.github.io/plausibler/reference/pa_get_page_aggregate.md)
  : Get aggregated stats for a given page
- [`pa_get_page_timeseries()`](https://giocomai.github.io/plausibler/reference/pa_get_page_timeseries.md)
  : Get stats for a given page by time period
- [`pa_get_properties_by_date()`](https://giocomai.github.io/plausibler/reference/pa_get_properties_by_date.md)
  : Get combined breakdown by two properties and date
- [`pa_get_settings()`](https://giocomai.github.io/plausibler/reference/pa_get_settings.md)
  : Retrieves session settings
- [`pa_get_timeseries()`](https://giocomai.github.io/plausibler/reference/pa_get_timeseries.md)
  : Get time series
- [`pa_get_top_pages()`](https://giocomai.github.io/plausibler/reference/pa_get_top_pages.md)
  : Get most visited pages for a given period
- [`pa_set()`](https://giocomai.github.io/plausibler/reference/pa_set.md)
  : Set API key for the current session

